<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GPVC98SDG9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-GPVC98SDG9');
    </script>
    
    <link rel="shortcut icon" type="img/jpg" href="/icons.ico">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600;700;800&family=Frank+Ruhl+Libre:wght@200;300;400;500;600&family=Encode+Sans+Semi+Condensed:wght@400&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/all.min.css">
    <link disabled id="dark-mode-theme" rel="stylesheet" href="/css/dark.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    
    
    
    
    
    <title>khangruni | API gateway with AWS</title>
    <meta name="description" content="Discovering API gateway service with AWS">
</head><body><nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand" href="https://khangt1k25.github.io/">
            
            <b style="font-weight: 800;">Khangruni</b>
            
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav ms-auto mt-2 mt-lg-0"><li class='nav-item '>
                    <a class="nav-link" href="/garden/"> My Garden</a>
                </li>
            <li class='nav-item '>
                    <a class="nav-link" href="/tech/"> Tech</a>
                </li>
            <li class='nav-item '>
                    <a class="nav-link" href="/book/"> Book</a>
                </li>
            <li class='nav-item '>
                    <a class="nav-link" href="/portfolio/"> Portfolio</a>
                </li>
            <li class='nav-item '>
                    <a class="nav-link" href="/gallery/"> Gallery</a>
                </li>
            <li class='nav-item '>
                    <a class="nav-link" href="/about/"> About</a>
                </li>
             
            <li class="nav-item px-2 pt-1">
                <a class="btn fas fa-moon" id="dark-mode-toggle"></a>
            </li>
            </ul>
        </div>
    </div>
</nav><div id="content">

<div class="container" style="max-width: 800px;">
    <div class="py-4 rounded-3">
        <div class="container-fluid py-2">
            <h1 class="display-2 mb-4 text-center">API gateway with AWS</h1>
        </div>
        
        <p class="text-center fs-4 fst-italic serif">Discovering API gateway service with AWS</p>
        
        <div class="text-center pt-4">
            
        </div>
    </div>
    <div class="row justify-content-center mb-5">
        <div class="col-12">
            <p class="card-date m-0">
                
                
                    Created Apr 12, 2024 - 
                
                Last updated: Apr 12, 2024
            </p>
            <hr class="dropdown-divider">
            <div class="row justify-content-between">
                <div class="col-sm-4">
                    
    
    <span class="status">Evergreen üå≥</span>
    

                </div>
                <div class="col-sm-8" style="text-align: right;">
                    
                
                
                    
                    <span class="badge tag-badge">api gateway</span>
                    
                    <span class="badge tag-badge">backend</span>
                    
                    <span class="badge tag-badge">aws</span>
                    
                
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid py-2">
        <div class="serif main-content">
            <p><i>H√† Tƒ©nh, Qu√™ h∆∞∆°ng coffee, Chi·ªÅu th·ª© 6</i></p>
<img src="images/quehuong.jpeg" alt="Qu√™ h∆∞∆°ng coffee" style="width:100%">
<h2 id="the-begin">The Begin</h2>
<p>C∆° duy√™n c·ªßa m√¨nh ƒë·ªëi v·ªõi AWS - Amazon Web Services ƒë·∫øn khi d·ª± √°n m·ªõi c·ªßa c√¥ng ty m√¨nh chuy·ªÉn sang d√πng 100% d·ªãch v·ª• c·ªßa AWS - m·ªôt th·ª© m·ªõi m·∫ª v·ªõi c√°c anh em trong c√¥ng ty v√† v·ªõi m√¨nh.</p>
<p>D·ªãch v·ª• ƒë·∫ßu ti√™n c·ªßa AWS m√† m√¨nh t√¨m hi·ªÉu s·ª≠ d·ª•ng l√† API Gateway, c≈©ng l√† core ƒë·ªÉ x√¢y d·ª±ng n√™n APIX phi√™n b·∫£n ƒë·∫ßu ti√™n. Trong b√†i n√†y m√¨nh s·∫Ω t√¨m hi·ªÉu t·∫•t t·∫ßn t·∫≠t v·ªÅ d·ªãch v·ª• n√†y.</p>
<blockquote>
<p>Amazon API Gateway is an AWS service for creating, publishing, maintaining, monitoring, and securing REST, HTTP, and WebSocket APIs at any scale.</p>
</blockquote>
<h2 id="excellent-views--aws-api-gateway">Excellent views:  AWS API Gateway</h2>
<p>AWS chia service c·ªßa h·ªç th√†nh c√°c l√°t c·∫Øt t∆∞∆°ng ·ª©ng v·ªõi qu√° tr√¨nh thao t√°c v·ªõi API Gateway. R·∫•t d·ªÖ hi·ªÉu khi m·ªõi s·ª≠ d·ª•ng.</p>
<ul>
<li>Develop: T·∫•t c·∫£ c√°c setup li√™n quan ƒë·∫øn API v·ªÅ c·∫•u h√¨nh, k·∫øt n·ªëi, ‚Ä¶</li>
<li>Deploy: C√°c setup li√™n quan vi·ªác deploy c√°c API l√™n API gateway</li>
<li>Monitor: C√°c k·∫øt n·ªëi sang logs</li>
<li>Protect: C√°c setup li√™n quan ƒë·∫øn throttle, rate limit</li>
<li>Optimize: C√°c t·ªëi ∆∞u bao g·ªìm caching, compression</li>
<li>Distribute: C√°c setup li√™n quan ƒë·∫øn g√≥i s·ª≠ d·ª•ng, key c·ªßa client</li>
</ul>
<h2 id="develop-api-gateway">Develop: API Gateway</h2>
<p>ƒê√¢y l√† thu·∫≠t ng·ªØ ch·ªâ chung v·ªÅ gateway, l√† l·ªõp ngo√†i c√πng cho ph√©p t·∫°o, deploy, qu·∫£n l√Ω v√† theo d√µi c√°c API c√≥ trong gateway. API gateway c·ªßa AWS h·ªó tr·ª£ k·∫øt n·ªëi v·ªõi c√°c service theo ba d·∫°ng: REST API, HTTP API, Websocket API. N√≥i v·ªÅ ph·∫ßn core c·ªßa API gateway th√¨ vi·ªác qu·∫£n l√Ω hay HA core ƒë·ªÅu thu·ªôc v·ªÅ AWS. Nghƒ©a l√† m√¨nh kh√¥ng c·∫ßn b·∫≠n t√¢m ƒë·∫øn vi·ªác deploy API gateway m√† m·ªói account s·∫Ω ƒë∆∞·ª£c hay coi nh∆∞ ƒë∆∞·ª£c c·∫•p 1 gateway ( manage by AWS) v√† vi·ªác c·ªßa m√¨nh ch·ªâ l√† setup v√† s·ª≠ d·ª•ng c√°c APIs trong gateway ƒë√≥.</p>
<h2 id="develop-apis">Develop: APIs</h2>
<p>Kh√°i ni·ªám API ·ªü AWS service ƒë·ªÉ ch·ªâ 1 t·∫≠p-b·ªô c√°c API endpoint h∆∞·ªõng ƒë·∫øn m·ªôt s·ªë nhi·ªám v·ª• chung. M·ªói API s·∫Ω ƒë∆∞·ª£c ƒë·ªãnh danh b·ªüi ID v√† ƒë∆∞·ª£c setup theo nhi·ªÅu lo·∫°i k·∫øt n·ªëi k·ªÉ tr√™n.</p>
<img src="images/apis.png" alt="APIs" style="width:100%">
<h2 id="develop-api-routes">Develop: API Routes</h2>
<p>Khi client g·ªçi ƒë·∫øn API trong Gateway th√¨ Gateway s·∫Ω d·ª±a v√†o route ƒë·ªÉ ti·∫øn h√†nh g·ªçi xu·ªëng c√°c service t∆∞∆°ng ·ª©ng ƒë√£ ƒë∆∞·ª£c setup. Do ƒë√≥ vi·ªác ƒë·∫∑t t√™n v√† ƒë·ªãnh danh cho route l√† b∆∞·ªõc quan tr·ªçng ƒë·∫ßu ti√™n khi m√¨nh setup API.</p>
<p>C√°c route ƒë∆∞·ª£c ƒë·ªãnh danh b√™n t√™n c·ªßa n√≥. V√≠ d·ª• v·ªõi routes l√† /pets.  M√¨nh c√≥ th·ªÉ x√°c ƒë·ªãnh c√°c method (ƒë·ªÅ c·∫≠p sau) c·ª• th·ªÉ cho route c·ªßa m√¨nh. Ho·∫∑c, m√¨nh c√≥ th·ªÉ s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c ANY ƒë·ªÉ ph√π h·ª£p v·ªõi t·∫•t c·∫£ c√°c ph∆∞∆°ng th·ª©c m√† ch∆∞a x√°c ƒë·ªãnh. Ngo√†i ra m√¨nh c√≥ th·ªÉ t·∫°o m·ªôt route $default ho·∫°t ƒë·ªông nh∆∞ m·ªôt route m·∫∑c ƒë·ªãnh s·∫Ω b·∫Øt h·∫øt c√°c request m√† kh√¥ng ƒë∆∞·ª£c x√°c ƒë·ªãnh.</p>
<p>V·ªõi c·∫∑p Route v√† Method s·∫Ω ƒë·ªãnh danh ƒë·∫øn service.</p>
<img src="images/routes.png" alt="API routes" style="width:100%">
<h2 id="develop-api-authorizers">Develop: API Authorizers</h2>
<p>V·ªõi m·ªói route, AWS s·∫Ω ch√¨a ra ·ªü m·ªôt d·∫°ng attach route v·ªõi m·ªôt l·ªõp b·∫£o v·ªá Authorizer. C∆° ch·∫ø n√†y c√≤n ƒë∆∞·ª£c g·ªçi l√† Access Control. M·ªói Authorizer s·∫Ω c√≥ nhi·ªám v·ª• b·∫£o v·ªá, ki·ªÉm so√°t v√† x√°c minh c√°c request c√≥ h·ª£p l·ªá hay kh√¥ng. M·ªôt s·ªë ki·ªÉu c∆° ch·∫ø c√≥ th·ªÉ s·ª≠ d·ª•ng:</p>
<ul>
<li><strong>Lambda authorizers:</strong> S·∫Ω s·ª≠ d·ª•ng m·ªôt ho·∫∑c nhi·ªÅu h√†m Lambda ƒë·ªÉ l√†m h√†m verify. C√°ch l√†m n√†y c√≥ l·ª£i th·∫ø l√† m√¨nh c√≥ to√†n kh·∫£ nƒÉng custom logic theo √Ω mu·ªën. N√¥m na v·ªõi m·ªôt h√†m ƒë·∫ßu v√†o v·ªõi th√¥ng tin c·ªßa request v√† API, m√¨nh ph·∫£i vi·∫øt logic 1 h√†m ƒë·ªÉ tr·∫£ v·ªÅ ch·∫•p nh·∫≠n hay kh√¥ng request n√†y. H√†m Lambda Authorizer s·∫Ω lu√¥n ƒë∆∞·ª£c g·ªçi ngay sau khi x√°c ƒë·ªãnh ƒë∆∞·ª£c route v√† tr∆∞·ªõc khi g·ªçi xu·ªëng service. ƒê√¢y l√† c√°ch m√¨nh s·ª≠ d·ª•ng trong d·ª± √°n APIX. C√°c logic li√™n quan ƒë·∫øn Authorization hay Limit Quota, Subscription ƒë·ªÅu ƒë∆∞·ª£c x·ª≠ l√Ω t·∫°i b∆∞·ªõc n√†y.</li>
<li><strong>JWT authorizers:</strong> S·ª≠ d·ª•ng l·∫°i c∆° ch·∫ø JWT truy·ªÅn th·ªëng. Xem th√™m t·∫°i:¬†<a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-jwt-authorizer.html">Controlling access to HTTP APIs with JWT authorizers</a>.</li>
<li><strong>Standard AWS IAM roles and policies:</strong> C∆° ch·∫ø n√†y s·ª≠ d·ª•ng AWS IAM roles. M√¨nh ch∆∞a t√¨m hi·ªÉu kƒ© n√™n ƒë·ªçc th√™m ·ªü ƒë√¢y nh√©:¬†<a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-access-control-iam.html">Using IAM authorization</a>.</li>
</ul>
<h2 id="develop-api-methods">Develop: API Methods</h2>
<p>API methods ch√≠nh l√† c√°c ph∆∞∆°ng th·ª©c ti·∫øn h√†nh g·ªçi v√†o API. C√°c Methods bao g·ªìm: GET, POST, PUT, DELETE, PATCH, ANY ( ƒë√¢y l√† ph∆∞∆°ng th·ª©c nh·∫≠n to√†n b·ªô c√°c ph∆∞∆°ng th·ª©c)</p>
<img src="images/routeMethod.png" alt="API route methods" style="width:100%">
<p>Khi m√¨nh setup method th√¨ ngo√†i vi·ªác x√°c ƒë·ªãnh r√µ ph∆∞∆°ng th·ª©c c·ªßa API ƒë√≥ th√¨ c√≤n ƒë·ªìng th·ªùi setup th√™m v·ªÅ request params, payload, header b·∫Øt bu·ªôc khi g·ªçi. ƒê·ªëi v·ªõi output th√¨ m√¨nh ph·∫£i setup status code, headers v√† body tr·∫£ v·ªÅ d·ª±a theo response t·ª´ c√°c service backend.</p>
<h2 id="develop-api-integration">Develop: API Integration</h2>
<p>Integration ch√≠nh l√† k·∫øt n·ªëi t·ª´ gateway ƒë·∫øn c√°c upstream service ·ªü ph√≠a d∆∞·ªõi. H√£y t∆∞·ªüng t∆∞·ª£ng, sau khi ti·∫øn h√†nh t√¨m ki·∫øm v√† matching ƒë∆∞·ª£c request t·ª´ client v√† route c√≥ trong gateway. V·ªõi m·ªói route v√† method, s·∫Ω g·ªçi xu·ªëng integration ·ª©ng v·ªõi n√≥.</p>
<p>Hi·ªán t·∫°i Integration trong AWS h·ªó tr·ª£ k·∫øt n·ªëi theo c√°c d·∫°ng sau:</p>
<ul>
<li>AWS lambda service: G·ªçi th·∫≥ng xu·ªëng lambda c·ªßa AWS ( c≈©ng l√† 1 d·ªãch v·ª• serverless c·ªßa AWS)</li>
<li>HTTP API: G·ªçi ƒë·∫øn 1 public HTTP API, ƒë√¢y l√† ki·ªÉu proxy integration. V√≠ d·ª• m√¨nh c√≥ 1 service ri√™ng ·ªü ¬†<code>https://petstore-khang.com/pets</code> . Sau khi m√¨nh attach HTTP integration n√†y v√†o v·ªõi route v√† method GET /pets th√¨ khi g·ªçi client g·ªçi ƒë·∫øn GET /pets, c√°c th√¥ng tin v·ªÅ request s·∫Ω ƒë∆∞·ª£c call xu·ªëng v·ªÅ  service c·ªßa m√¨nh l√† <code>https://petstore-khang.com/pets</code>. Ngo√†i ra m√¨nh c√≥ th·ªÉ c√†i ƒë·∫∑t v·ªÅ timeout - th·ªùi gian ph·∫£n h·ªìi t·ªëi ƒëa c·ªßa 1 request ƒë·∫øn Integration n√†y, n·∫øu v∆∞·ª£t qu√° s·∫Ω raise l·ªói.</li>
</ul>
<img src="images/integration.png" alt="API integration" style="width:100%">
<p>·ªû API Integration c√≥ m·ªôt nhi·ªám v·ª• n·ªØa ƒë√≥ l√† transform c√°c request, response ƒë·∫øn upstream service. G·ªçi t·∫Øt l√† Parameter Mapping.</p>
<ul>
<li>
<p>Transform API requests: ·ªû ƒë√¢y m√¨nh c√≥ th·ªÉ thay ƒë·ªïi th√¥ng tin c·ªßa request tr∆∞·ªõc khi g·ª≠i ƒë·∫øn upstream service nh∆∞ thay ƒë·ªïi, th√™m, s·ª≠a, xo√° c√°c header, querystring, v√† path, ‚Ä¶ V·ªõi v√≠ d·ª• d∆∞·ªõi l√† th√™m gi√° tr·ªã c·ªßa querystring v√† header v·ªõi c·∫∑p key-value l√† {name: Khang} v√† {fromService: Amazon}. V·ªõi setup n√†y th√¨ ·ªü d∆∞·ªõi service s·∫Ω nh·∫≠n ƒë∆∞·ª£c gi√° tr·ªã t∆∞∆°ng ·ª©ng. Ngo√†i vi·ªác s·ª≠ d·ª•ng c√°c static value th√¨ AWS c√≤n support c√°c value ·ªü d·∫°ng tƒ©nh ƒë·ªÉ c√≥ th·ªÉ b·∫Øt ƒë∆∞·ª£c c√°c context khi g·ªçi nh∆∞ ƒë·ªãa ch·ªâ IP, Region, ‚Ä¶
<img src="images/requestmapping.png" alt="Request Mapping" style="width:100%"></p>
</li>
<li>
<p>Transform API response: ·ªû ƒë√¢y sau khi nh·∫≠n response t·ª´ upstream service, m√¨nh c√≥ th·ªÉ thay ƒë·ªïi c√°c th√¥ng tin c·ªßa response v√≠ d·ª• nh∆∞ headers, status code, body, ‚Ä¶ C≈©ng nh∆∞ ·ªü tr√™n, ·ªü ƒë√¢y m√¨nh thay ƒë·ªïi status code t·ª´ 200 v·ªÅ 202 v√† th√™m 1 header tr·∫£ v·ªÅ l√† change = True
<img src="images/responsemapping.png" alt="Response Mapping" style="width:100%"></p>
</li>
</ul>
<h2 id="deploy-api-stage-and-api-deployment">Deploy: API Stage and API Deployment</h2>
<p>V·ªõi API Stage l√† ƒë·∫øn giai ƒëo·∫°n setup xong c·∫•u h√¨nh c·ªßa API, chuy·ªÉn sang giai ƒëo·∫°n publish API ra ngo√†i. API Stage l√† m·ªôt ƒë·ªãnh danh logic ch·ªâ stage c·ªßa API ƒë√≥ trong Gateway. V√≠ d·ª• nh∆∞ dev, prod, v1, v2. V√† n√≥ s·∫Ω ƒë∆∞·ª£c g·∫Øn v√†o URL expose ra b√™n ngo√†i g·ªçi l√† Invoke URL. Trong m·ªói stage th√¨ c√≥ c√°c configure ƒë·ªÉ c√≥ th·ªÉ t·ª± ƒë·ªông deploy m·ªói khi c√≥ thay ƒë·ªïi ·ªü c·∫•u h√¨nh API.</p>
<p>V·ªõi API Deployment, l√† m·ªôt b·∫£n snapshot c·ªßa c·∫•u h√¨nh API v√† ƒë∆∞·ª£c g·∫Øn v·ªõi API v√† Stage.</p>
<img src="images/stage.png" alt="API stage" style="width:100%">
<h2 id="deploy-custom-domain-name">Deploy: Custom Domain Name</h2>
<p>Sau khi deploy th√†nh c√¥ng API t∆∞∆°ng ·ª©ng v·ªõi stage, V√≠ d·ª• nh∆∞ tr√™n v·ªõi Invoke URL kh√° x·∫•u v√† ƒë·ªÉ l·ªô ra th√¥ng tin c·∫•u h√¨nh. Trong th·ª±c t·∫ø, ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng Domain Name ƒë·ªÉ thay th·∫ø cho URL n√†y.</p>
<p>Sau khi ti·∫øn h√†nh register domain h·ª£p l·ªá v√† ch√∫ng ta thi·∫øt l·∫≠p l·∫°i c∆° ch·∫ø Mapping nh∆∞ sau. Sau ƒë√≥ thay v√¨ g·ªçi v√†o Invoke URL, ch√∫ng ta s·∫Ω g·ªçi API th√¥ng qua Domain Name URL c·ªßa m√¨nh.</p>
<table>
<thead>
<tr>
<th><a href="https://khang.api.example.com/prod">https://khang.api.example.com/prod</a></th>
<th><a href="https://92d27nzpl6.execute-api.ap-southeast-1.amazonaws.com/prod">https://92d27nzpl6.execute-api.ap-southeast-1.amazonaws.com/prod</a></th>
</tr>
</thead>
</table>
<h2 id="monitor-logging">Monitor: Logging</h2>
<p>Khi ƒë√£ ho√†n th√†nh vi·ªác setup v·ªÅ c·∫£ develop v√† deploy. Th√¨ k·∫ø ti·∫øp l√† giai ƒëo·∫°n setup v·ªÅ Logging ƒë·ªÉ ti·∫øn h√†nh Monitor.  ·ªû ƒë√¢y AWS h·ªó tr·ª£ vi·ªác setup l∆∞u l·∫°i c√°c Access Log - l√† c√°c Log li√™n quan ƒë·∫øn request v√† response. Th√¥ng th∆∞·ªùng ·ªü ƒë√¢y m√¨nh s·∫Ω ch·ªçn lu√¥n Log Destination l√† m·ªôt Log Group trong AWS CloudWatch.  N·ªôi dung c·ªßa t·ª´ng record log s·∫Ω ƒë∆∞·ª£c m·∫∑c ƒë·ªãnh v√† th√™m b·ªõt theo format nh∆∞ d∆∞·ªõi. V√≠ d·ª• nh∆∞ m√¨nh mu·ªën log v·ªÅ IP th√¨ d√πng $context.identity.sourceIP.  Tu·ª≥ v√†o tr∆∞·ªùng h·ª£p m√¨nh c·∫ßn l∆∞u log record nh∆∞ th·∫ø n√†o ƒë·ªÉ d·ªÖ d√†ng tracking v√† l√†m c√°c t√°c v·ª• th·ªëng k√™ sau n√†y.</p>
<img src="images/logging.png" alt="API logging" style="width:100%">
<h2 id="protect-rate-limit-and-burst-limit">Protect: Rate limit and Burst limit</h2>
<p>Nh∆∞ ƒë√£ ƒë·ªÅ c·∫≠p ·ªü <a href="https://khangt1k25.github.io/tech/api_gateway/:">b√†i tr∆∞·ªõc v·ªÅ API Gateway n√≥i chung</a>. C√°c t√≠nh nƒÉng v·ªÅ Limit l√† th·ª© kh√¥ng th·ªÉ thi·∫øu ·ªü API Gateway. ·ªû AWS, h·ªç ƒë√£ ƒë∆∞a ph·∫ßn Limit n√†y v√†o Protect Views - d∆∞·ªõi d·∫°ng API limit. Nghƒ©a r·∫±ng, v·ªõi m·ªói API m√¨nh s·∫Ω ƒë∆∞·ª£c setup c√°c c·∫•u h√¨nh limit ri√™ng. Core n·∫±m b√™n d∆∞·ªõi c·ªßa h·ªç v·∫´n l√† thu·∫≠t to√°n v·ªÅ Bucket ƒë·ªÉ ƒë·∫øm token counter cho m·ªôt ƒë·ªãnh danh truy v·∫•n.  V·ªõi m·ªôt c·∫•u h√¨nh th√¨ c√≥ th·ªÉ setup 2 th√¥ng s·ªë</p>
<ul>
<li>Rate Limit : s·ªë request nh·∫≠n t·ªëi ƒëa trong m·ªôt gi√¢y ƒë·ªìng h·ªì</li>
<li>Burst Limit: S·ªë request t·ªëi ƒëa ƒë∆∞·ª£c x·ª≠ l√Ω t·∫°i m·ªôt th·ªùi ƒëi·ªÉm</li>
</ul>
<p>Ngo√†i ra c√≤n support Limit d·ª±a tr√™n Account</p>
<img src="images/ratelimit.png" alt="API rate burst limit" style="width:100%">
<h2 id="optimize-caching">Optimize: Caching</h2>
<p>Sau khi ho√†n th√†nh c√°c view tr∆∞·ªõc, ƒë√¢y l√† view addons v·ªõi t√™n l√† Optimize - nh·∫±m t·ªëi ∆∞u vi·ªác s·ª≠ d·ª•ng v√† qu·∫£n l√Ω API Gateway. Trong ƒë√≥, m·ªôt c√°ch t·ªëi ∆∞u ƒë∆°n gi·∫£n v√† hi·ªáu qu·∫£ ƒë√≥ l√† Caching. V·ªõi Caching th√¨ s·∫Ω l√†m gi·∫£m ƒë∆∞·ª£c s·ªë l·∫ßn m√† API Gateway g·ªçi xu·ªëng c√°c service do c√°c k·∫øt qu·∫£ ƒë√£ ƒë∆∞·ª£c cache l·∫°i (g·ªçi l√† cached response) v√† tr·∫£ v·ªÅ ngay.  Th·ªùi gian l∆∞u tr·ªØ c·ªßa cached response d·ª±a theo th√¥ng s·ªë TTL ( time-to-live) x√°c ƒë·ªãnh kho·∫£ng th·ªùi gian t·ªìn t·∫°i c·ªßa 1 cached response object trong h·ªá th·ªëng.</p>
<h2 id="distribute-usage-plan-and-api-key">Distribute: Usage Plan and API Key</h2>
<p>Usage plan l√† m·ªôt g√≥i s·ª≠ d·ª•ng API, khi ƒë∆∞·ª£c g·∫Øn v·ªõi API v√† Client, n√≥ s·∫Ω x√°c ƒë·ªãnh ra b·ªô limit t∆∞∆°ng ·ª©ng d√†nh cho ng∆∞·ªùi ƒë√≥ khi g·ªçi API.  Ta c√≥ th·ªÉ setup c√°c th√¥ng s·ªë v·ªÅ Rate, Burst cho g√≥i, ngo√†i ra c√≤n c√≥ th√¥ng s·ªë v·ªÅ Quota, x√°c ƒë·ªãnh hard limit d√†nh theo ng√†y/th√°ng/tu·∫ßn. V√≠ d·ª•: G√≥i free ·ªü d∆∞·ªõi ƒë∆∞·ª£c c·∫•u h√¨nh rate = 100, burst = 100 v√† quota cho 1 th√°ng s·ª≠ d·ª•ng l√† 10K requests.</p>
<img src="images/usageplan.png" alt="API usage plan" style="width:100%">
<p>API key l√† m·ªôt ƒëo·∫°n string ƒë∆∞·ª£c generate ra v√† s·∫Ω ƒë∆∞a cho client s·ª≠ d·ª•ng. M·ªôt API Key s·∫Ω c√≥ name ( t√™n c·ªßa key) v√† value ( gi√° tr·ªã l√† ƒëo·∫°n string - c·∫ßn ƒë∆∞·ª£c gi·ªØ b√≠ m·∫≠t, ch·ªâ client nh·∫•t ƒë·ªãnh m·ªõi c√≥ ƒë∆∞·ª£c gi√° tr·ªã n√†y). Client s·∫Ω s·ª≠ d·ª•ng API Key n√†y ƒë·ªÉ g·ªçi ƒë·∫øn API Gateway. V·ªÅ m·∫∑t API Gateway, n√≥ s·∫Ω kh√¥ng quan t√¢m b√™n ngo√†i l√† Client n√†o m√† s·∫Ω ch·ªâ quan t√¢m ƒë·∫øn Key n√†o v·ª´a g·ªçi ? Key ƒë√≥ c√≥ quy·ªÅn Access hay kh√¥ng ? Khi design h·ªá th·ªëng c√≥ th·ªÉ coi 1 API key l√† 1 user ho·∫∑c 1 group.</p>
<p>Gi·ªù l√† b∆∞·ªõc <strong>Associated</strong> gi·ªØa API, Usage plan v√† API Key. Ph·∫£i tr·∫£ l·ªùi hai c√¢u h·ªèi sau ƒë√¢y.</p>
<p>G√≥i free n√†y s·∫Ω s·ª≠ d·ª•ng tr√™n API n√†o? AWS s·∫Ω cho ph√©p ta c·∫•u h√¨nh <strong>Associated stages.</strong>  Ta s·∫Ω g·∫Øn g√≥i free v·ªõi m·ªôt API Stage v·ªõi c√¢u tr·∫£ l·ªùi r·∫±ng: G√≥i free n√†y s·ª≠ d·ª•ng tr√™n API n√†y.</p>
<p>Ai s·∫Ω s·ª≠ d·ª•ng g√≥i free n√†y?  Ta s·∫Ω <strong>Associate API Key</strong> c·ªßa client 1 v√†o ƒë·ªÉ client 1 c√≥ th·ªÉ s·ª≠ d·ª•ng g√≥i free.</p>
<p>Sau khi xong b∆∞·ªõc n√†y, client 1 c√≥ th·ªÉ g·ªçi ƒë·∫øn API v·ªõi g√≥i l√† free - c√≥ c√°c th√¥ng s·ªë nh∆∞ c·∫•u h√¨nh ·ªü g√≥i.</p>
<img src="images/associated_apikeys.png" alt="Request Mapping" style="width:100%">
<h2 id="advantages">Advantages</h2>
<p>Sau qu√° tr√¨nh s·ª≠ d·ª•ng AWS API Gateway ƒë·ªÉ build l√™n h·ªá th·ªëng API marketplace trong d·ª± √°n c·ªßa c√¥ng ty. M√¨nh nh·∫≠n th·∫•y ƒë√¢y l√† m·ªôt service si√™u ti·ªán d·ª•ng ƒë·∫øn t·ª´ nh√† AWS v√† h∆∞·ªõng ƒë·∫øn vi·ªác t·ªëi gi·∫£n ho√° c√°c b∆∞·ªõc khi t·∫°o API Gateway. M·ªôt s·ªë ∆∞u ƒëi·ªÉm theo m√¨nh c·∫£m nh·∫≠n:</p>
<ul>
<li>Ti·ªán l·ª£i, d·ªÖ d√πng, kh√¥ng c·∫ßn ph·∫£i code custom qu√° nhi·ªÅu, ph√π h·ª£p cho c√°c API gateway kh√¥ng c·∫ßn custom qu√° nhi·ªÅu</li>
<li>Kh√¥ng c·∫ßn ph·∫£i HA, ch·ªãu t·∫£i v√† scale  - ƒë√£ c√≥ AWS lo</li>
<li>C√≥ c√°c documen r·∫•t clear v√† c√≥ use-case c·ª• th·ªÉ ƒë·ªÉ m√¨nh tham kh·∫£o v√† quan tr·ªçng l√† c√≥ API, SDK ch√¨a ra ƒë·ªÉ setup</li>
<li>D·ªÖ d√†ng k·∫øt n·ªëi ƒë·∫øn c√°c  Internal Service c·ªßa nh√† AWS.</li>
</ul>
<h2 id="disadvantages">Disadvantages</h2>
<p>Ngo√†i nh·ªØng ∆∞u ƒëi·ªÉm v·ªÅ d·ªÖ d√†ng s·ª≠ d·ª•ng th√¨ sau ƒë√¢y l√† c·∫£m nh·∫≠n c·ªßa m√¨nh kh√¥ng th√≠ch khi s·ª≠ d·ª•ng AWS API Gateway, ƒë√≥ c≈©ng l√† nh·ªØng tham kh·∫£o ƒë·ªÉ c√°c b·∫°n c√≥ th·ªÉ l·ª±a ch·ªçn stack ph√π h·ª£p nh√©.</p>
<ul>
<li>T√≠nh customize th·∫•p, l√† s·ª± trade off gi·ªØa s·ª± ƒë∆°n gi·∫£n v√† t√≠nh m·∫°nh m·∫Ω. ƒê·ªëi v·ªõi m√¨nh th√¨ khi s·ª≠ d·ª•ng, m√¨nh ∆∞u ti√™n t√≠nh customize n√†y h∆°n do s·ª± ph·ª©c t·∫°p c·ªßa m·ªôt s√†n API team x√¢y d·ª±ng. V√≠ d·ª• ch·ªâ c√≥ 1 Authorizer l√† kh√¥ng ƒë·ªß v√† t·ªëc ƒë·ªô ch·∫≠m khi x·ª≠ l√Ω to√†n b·ªô c√°c t√°c v·ª• customize tr∆∞·ªõc khi g·ªçi request.</li>
<li>B·ªã limit r·∫•t nhi·ªÅu: C√°c Limit v·ªÅ s·ªë API, s·ªë Endpoint hay v·ªÅ Protect ƒë·ªÅu c√≥ gi·ªõi h·∫°n tr√™n ·ªü m·ªói t√†i kho·∫£n, v√† ph·∫£i li√™n h·ªá ƒë·ªÉ extend ra. Kh√¥ng ch·ªâ v·∫≠y th√¨ m·ªôt s·ªë c·∫•u h√¨nh c√≤n b·ªã hard limit ( kh√¥ng th·ªÉ m·ªü r·ªông h∆°n ). ƒêi·ªÅu n√†y ·∫£nh h∆∞·ªõng r·∫•t nhi·ªÅu ƒë·∫øn c·∫•u tr√∫c c√°c APIs. Do ƒë√≥ tr∆∞·ªõc khi x√¢y d·ª±ng n√™n t√¨m hi·ªÉu kƒ© ph·∫ßn limit n√†y ƒë·ªÉ design h·ª£p l√Ω. Chi ti·∫øt xem th√™m <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/limits.html">t·∫°i ƒë√¢y</a></li>
</ul>
<h2 id="the-conclusion">The Conclusion</h2>
<p>ƒê√≥ l√† nh·ªØng tr·∫£i nghi·ªám c·ªßa m√¨nh v√† ƒë√¢y c≈©ng coi nh∆∞ m·ªôt bu·ªïi review v·ªÅ AWS API Gateway. Tuy c√≥ nh·ªØng ∆∞u ƒëi·ªÉm v√† l√† n∆°i r·∫•t t·ªët ƒë·ªÉ b·∫Øt ƒë·∫ßu, nh∆∞ng m√¨nh nghƒ© ƒë√¢y kh√¥ng ph·∫£i l√† l·ª±a ch·ªçn t·ªët cho nh·ªØng h·ªá th·ªëng ph·ª©c t·∫°p.  Do ƒë√≥, m√¨nh c≈©ng sang t√¨m hi·ªÉu tech stack kh√°c v·ªÅ API Gateway v√† c√°i t√™n ti·∫øp theo ƒë√≥ l√† Kong Gateway. V√† s·∫Ω l·∫°i l√† m·ªôt h√†nh tr√¨nh ti·∫øp theo ƒë·ªÉ build c√πng v·ªõi Kong. M√¨nh s·∫Ω k·ªÉ v·ªÅ n√≥ ·ªü ph·∫ßn sau.</p>
<p>Xem l·∫°i b√†i tr∆∞·ªõc nh√©:</p>
<ul>
<li><a href="/tech/api_gateway/">The very first: API Gateway</a></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-rest-api.html">https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-rest-api.html</a></li>
<li><a href="https://viblo.asia/p/tim-hieu-aws-api-gateway-RnB5pMW2KPG">https://viblo.asia/p/tim-hieu-aws-api-gateway-RnB5pMW2KPG</a></li>
<li><a href="https://docs.aws.amazon.com/apigateway/">https://docs.aws.amazon.com/apigateway/</a></li>
<li><a href="https://www.youtube.com/watch?v=sDxsTPbUiik">https://www.youtube.com/watch?v=sDxsTPbUiik</a></li>
</ul>

        </div>
    </div>
    
    
        <div class="mt-20">
            <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "khangruni" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    

    
    

</div>


        </div><div class="container">
    <div class="row justify-content-between">
        <div class="col-sm-4">
            <p class="footer">Khangruni ¬© 2024 </p>
        </div>
        <div class="col-sm-6 d-flex flex-row-reverse">
            
            <a class="footer-social px-2"  href="https://www.facebook.com/trankhang.nguyen.35/" target="_blank"><i class="fab fa-facebook"></i></a>
            
            <a class="footer-social px-2"  href="https://github.com/khangt1k25" target="_blank"><i class="fab fa-github"></i></a>
            
            <a class="footer-social px-2"  href="https://www.linkedin.com/in/khang-nguyen-tran/" target="_blank"><i class="fab fa-linkedin-in"></i></a>
            
        </div>
    </div>
</div>
<script src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/jquery.min.js"></script>
<script src="/js/isotope.pkgd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D" crossorigin="anonymous" async></script>
<script src="/js/dark.js"></script>
<script>


var savedTheme = localStorage.getItem("dark-mode-storage") || "light" 
setTheme(savedTheme);

</script>
<script src="/js/isotope.js"></script>
<script src="/js/mermaid.min.js"></script>

<script>mermaid.initialize({ startOnLoad: true, securityLevel: 'loose'});</script>
</body>
</html>
