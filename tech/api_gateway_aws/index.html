<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GPVC98SDG9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-GPVC98SDG9');
    </script>
    
    <link rel="shortcut icon" type="img/jpg" href="/icons.ico">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600;700;800&family=Frank+Ruhl+Libre:wght@200;300;400;500;600&family=Encode+Sans+Semi+Condensed:wght@400&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/all.min.css">
    <link disabled id="dark-mode-theme" rel="stylesheet" href="/css/dark.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    
    
    
    
    
    <title>khangruni | API gateway with AWS</title>
    <meta name="description" content="Discovering API gateway service with AWS">
</head><body><nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand" href="https://khangt1k25.github.io/">
            
            <b style="font-weight: 800;">Khangruni</b>
            
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav ms-auto mt-2 mt-lg-0"><li class='nav-item '>
                    <a class="nav-link" href="/garden/"> My Garden</a>
                </li>
            <li class='nav-item '>
                    <a class="nav-link" href="/tech/"> Tech</a>
                </li>
            <li class='nav-item '>
                    <a class="nav-link" href="/book/"> Book</a>
                </li>
            <li class='nav-item '>
                    <a class="nav-link" href="/portfolio/"> Portfolio</a>
                </li>
            <li class='nav-item '>
                    <a class="nav-link" href="/gallery/"> Gallery</a>
                </li>
            <li class='nav-item '>
                    <a class="nav-link" href="/about/"> About</a>
                </li>
             
            <li class="nav-item px-2 pt-1">
                <a class="btn fas fa-moon" id="dark-mode-toggle"></a>
            </li>
            </ul>
        </div>
    </div>
</nav><div id="content">

<div class="container" style="max-width: 800px;">
    <div class="py-4 rounded-3">
        <div class="container-fluid py-2">
            <h1 class="display-2 mb-4 text-center">API gateway with AWS</h1>
        </div>
        
        <p class="text-center fs-4 fst-italic serif">Discovering API gateway service with AWS</p>
        
        <div class="text-center pt-4">
            
        </div>
    </div>
    <div class="row justify-content-center mb-5">
        <div class="col-12">
            <p class="card-date m-0">
                
                
                    Created Apr 12, 2024 - 
                
                Last updated: Apr 12, 2024
            </p>
            <hr class="dropdown-divider">
            <div class="row justify-content-between">
                <div class="col-sm-4">
                    
    
    <span class="status">Evergreen ğŸŒ³</span>
    

                </div>
                <div class="col-sm-8" style="text-align: right;">
                    
                
                
                    
                    <span class="badge tag-badge">api gateway</span>
                    
                    <span class="badge tag-badge">backend</span>
                    
                    <span class="badge tag-badge">aws</span>
                    
                
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid py-2">
        <div class="serif main-content">
            <p><i>HÃ  TÄ©nh, QuÃª hÆ°Æ¡ng coffee, Chiá»u thá»© 6</i></p>
<img src="images/quehuong.jpeg" alt="QuÃª hÆ°Æ¡ng coffee" style="width:100%">
<h2 id="the-begin">The Begin</h2>
<p>CÆ¡ duyÃªn cá»§a mÃ¬nh Ä‘á»‘i vá»›i AWS - Amazon Web Services Ä‘áº¿n khi dá»± Ã¡n má»›i cá»§a cÃ´ng ty mÃ¬nh chuyá»ƒn sang dÃ¹ng 100% dá»‹ch vá»¥ cá»§a AWS - má»™t thá»© má»›i máº» vá»›i cÃ¡c anh em trong cÃ´ng ty vÃ  vá»›i mÃ¬nh.</p>
<p>Dá»‹ch vá»¥ Ä‘áº§u tiÃªn cá»§a AWS mÃ  mÃ¬nh tÃ¬m hiá»ƒu sá»­ dá»¥ng lÃ  API Gateway, cÅ©ng lÃ  core Ä‘á»ƒ xÃ¢y dá»±ng nÃªn APIX phiÃªn báº£n Ä‘áº§u tiÃªn. Trong bÃ i nÃ y mÃ¬nh sáº½ tÃ¬m hiá»ƒu táº¥t táº§n táº­t vá» dá»‹ch vá»¥ nÃ y.</p>
<blockquote>
<p>Amazon API Gateway is an AWS service for creating, publishing, maintaining, monitoring, and securing REST, HTTP, and WebSocket APIs at any scale.</p>
</blockquote>
<h2 id="excellent-views--aws-api-gateway">Excellent views:  AWS API Gateway</h2>
<p>AWS chia service cá»§a há» thÃ nh cÃ¡c lÃ¡t cáº¯t tÆ°Æ¡ng á»©ng vá»›i quÃ¡ trÃ¬nh thao tÃ¡c vá»›i API Gateway. Ráº¥t dá»… hiá»ƒu khi má»›i sá»­ dá»¥ng.</p>
<ul>
<li>Develop: Táº¥t cáº£ cÃ¡c setup liÃªn quan Ä‘áº¿n API vá» cáº¥u hÃ¬nh, káº¿t ná»‘i, â€¦</li>
<li>Deploy: CÃ¡c setup liÃªn quan viá»‡c deploy cÃ¡c API lÃªn API gateway</li>
<li>Monitor: CÃ¡c káº¿t ná»‘i sang logs</li>
<li>Protect: CÃ¡c setup liÃªn quan Ä‘áº¿n throttle, rate limit</li>
<li>Optimize: CÃ¡c tá»‘i Æ°u bao gá»“m caching, compression</li>
<li>Distribute: CÃ¡c setup liÃªn quan Ä‘áº¿n gÃ³i sá»­ dá»¥ng, key cá»§a client</li>
</ul>
<h2 id="develop-api-gateway">Develop: API Gateway</h2>
<p>ÄÃ¢y lÃ  thuáº­t ngá»¯ chá»‰ chung vá» gateway, lÃ  lá»›p ngoÃ i cÃ¹ng cho phÃ©p táº¡o, deploy, quáº£n lÃ½ vÃ  theo dÃµi cÃ¡c API cÃ³ trong gateway. API gateway cá»§a AWS há»— trá»£ káº¿t ná»‘i vá»›i cÃ¡c service theo ba dáº¡ng: REST API, HTTP API, Websocket API. NÃ³i vá» pháº§n core cá»§a API gateway thÃ¬ viá»‡c quáº£n lÃ½ hay HA core Ä‘á»u thuá»™c vá» AWS. NghÄ©a lÃ  mÃ¬nh khÃ´ng cáº§n báº­n tÃ¢m Ä‘áº¿n viá»‡c deploy API gateway mÃ  má»—i account sáº½ Ä‘Æ°á»£c hay coi nhÆ° Ä‘Æ°á»£c cáº¥p 1 gateway ( manage by AWS) vÃ  viá»‡c cá»§a mÃ¬nh chá»‰ lÃ  setup vÃ  sá»­ dá»¥ng cÃ¡c APIs trong gateway Ä‘Ã³.</p>
<h2 id="develop-apis">Develop: APIs</h2>
<p>KhÃ¡i niá»‡m API á»Ÿ AWS service Ä‘á»ƒ chá»‰ 1 táº­p-bá»™ cÃ¡c API endpoint hÆ°á»›ng Ä‘áº¿n má»™t sá»‘ nhiá»‡m vá»¥ chung. Má»—i API sáº½ Ä‘Æ°á»£c Ä‘á»‹nh danh bá»Ÿi ID vÃ  Ä‘Æ°á»£c setup theo nhiá»u loáº¡i káº¿t ná»‘i ká»ƒ trÃªn.</p>
<img src="images/apis.png" alt="APIs" style="width:100%">
<h2 id="develop-api-routes">Develop: API Routes</h2>
<p>Khi client gá»i Ä‘áº¿n API trong Gateway thÃ¬ Gateway sáº½ dá»±a vÃ o route Ä‘á»ƒ tiáº¿n hÃ nh gá»i xuá»‘ng cÃ¡c service tÆ°Æ¡ng á»©ng Ä‘Ã£ Ä‘Æ°á»£c setup. Do Ä‘Ã³ viá»‡c Ä‘áº·t tÃªn vÃ  Ä‘á»‹nh danh cho route lÃ  bÆ°á»›c quan trá»ng Ä‘áº§u tiÃªn khi mÃ¬nh setup API.</p>
<p>CÃ¡c route Ä‘Æ°á»£c Ä‘á»‹nh danh bÃªn tÃªn cá»§a nÃ³. VÃ­ dá»¥ vá»›i routes lÃ  /pets.  MÃ¬nh cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh cÃ¡c method (Ä‘á» cáº­p sau) cá»¥ thá»ƒ cho route cá»§a mÃ¬nh. Hoáº·c, mÃ¬nh cÃ³ thá»ƒ sá»­ dá»¥ng phÆ°Æ¡ng thá»©c ANY Ä‘á»ƒ phÃ¹ há»£p vá»›i táº¥t cáº£ cÃ¡c phÆ°Æ¡ng thá»©c mÃ  chÆ°a xÃ¡c Ä‘á»‹nh. NgoÃ i ra mÃ¬nh cÃ³ thá»ƒ táº¡o má»™t route $default hoáº¡t Ä‘á»™ng nhÆ° má»™t route máº·c Ä‘á»‹nh sáº½ báº¯t háº¿t cÃ¡c request mÃ  khÃ´ng Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh.</p>
<p>Vá»›i cáº·p Route vÃ  Method sáº½ Ä‘á»‹nh danh Ä‘áº¿n service.</p>
<img src="images/routes.png" alt="API routes" style="width:100%">
<h2 id="develop-api-authorizers">Develop: API Authorizers</h2>
<p>Vá»›i má»—i route, AWS sáº½ chÃ¬a ra á»Ÿ má»™t dáº¡ng attach route vá»›i má»™t lá»›p báº£o vá»‡ Authorizer. CÆ¡ cháº¿ nÃ y cÃ²n Ä‘Æ°á»£c gá»i lÃ  Access Control. Má»—i Authorizer sáº½ cÃ³ nhiá»‡m vá»¥ báº£o vá»‡, kiá»ƒm soÃ¡t vÃ  xÃ¡c minh cÃ¡c request cÃ³ há»£p lá»‡ hay khÃ´ng. Má»™t sá»‘ kiá»ƒu cÆ¡ cháº¿ cÃ³ thá»ƒ sá»­ dá»¥ng:</p>
<ul>
<li><strong>Lambda authorizers:</strong> Sáº½ sá»­ dá»¥ng má»™t hoáº·c nhiá»u hÃ m Lambda Ä‘á»ƒ lÃ m hÃ m verify. CÃ¡ch lÃ m nÃ y cÃ³ lá»£i tháº¿ lÃ  mÃ¬nh cÃ³ toÃ n kháº£ nÄƒng custom logic theo Ã½ muá»‘n. NÃ´m na vá»›i má»™t hÃ m Ä‘áº§u vÃ o vá»›i thÃ´ng tin cá»§a request vÃ  API, mÃ¬nh pháº£i viáº¿t logic 1 hÃ m Ä‘á»ƒ tráº£ vá» cháº¥p nháº­n hay khÃ´ng request nÃ y. HÃ m Lambda Authorizer sáº½ luÃ´n Ä‘Æ°á»£c gá»i ngay sau khi xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c route vÃ  trÆ°á»›c khi gá»i xuá»‘ng service. ÄÃ¢y lÃ  cÃ¡ch mÃ¬nh sá»­ dá»¥ng trong dá»± Ã¡n APIX. CÃ¡c logic liÃªn quan Ä‘áº¿n Authorization hay Limit Quota, Subscription Ä‘á»u Ä‘Æ°á»£c xá»­ lÃ½ táº¡i bÆ°á»›c nÃ y.</li>
<li><strong>JWT authorizers:</strong> Sá»­ dá»¥ng láº¡i cÆ¡ cháº¿ JWT truyá»n thá»‘ng. Xem thÃªm táº¡i:Â <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-jwt-authorizer.html">Controlling access to HTTP APIs with JWT authorizers</a>.</li>
<li><strong>Standard AWS IAM roles and policies:</strong> CÆ¡ cháº¿ nÃ y sá»­ dá»¥ng AWS IAM roles. MÃ¬nh chÆ°a tÃ¬m hiá»ƒu kÄ© nÃªn Ä‘á»c thÃªm á»Ÿ Ä‘Ã¢y nhÃ©:Â <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-access-control-iam.html">Using IAM authorization</a>.</li>
</ul>
<h2 id="develop-api-methods">Develop: API Methods</h2>
<p>API methods chÃ­nh lÃ  cÃ¡c phÆ°Æ¡ng thá»©c tiáº¿n hÃ nh gá»i vÃ o API. CÃ¡c Methods bao gá»“m: GET, POST, PUT, DELETE, PATCH, ANY ( Ä‘Ã¢y lÃ  phÆ°Æ¡ng thá»©c nháº­n toÃ n bá»™ cÃ¡c phÆ°Æ¡ng thá»©c)</p>
<img src="images/routeMethod.png" alt="API route methods" style="width:100%">
<p>Khi mÃ¬nh setup method thÃ¬ ngoÃ i viá»‡c xÃ¡c Ä‘á»‹nh rÃµ phÆ°Æ¡ng thá»©c cá»§a API Ä‘Ã³ thÃ¬ cÃ²n Ä‘á»“ng thá»i setup thÃªm vá» request params, payload, header báº¯t buá»™c khi gá»i. Äá»‘i vá»›i output thÃ¬ mÃ¬nh pháº£i setup status code, headers vÃ  body tráº£ vá» dá»±a theo response tá»« cÃ¡c service backend.</p>
<h2 id="develop-api-integration">Develop: API Integration</h2>
<p>Integration chÃ­nh lÃ  káº¿t ná»‘i tá»« gateway Ä‘áº¿n cÃ¡c upstream service á»Ÿ phÃ­a dÆ°á»›i. HÃ£y tÆ°á»Ÿng tÆ°á»£ng, sau khi tiáº¿n hÃ nh tÃ¬m kiáº¿m vÃ  matching Ä‘Æ°á»£c request tá»« client vÃ  route cÃ³ trong gateway. Vá»›i má»—i route vÃ  method, sáº½ gá»i xuá»‘ng integration á»©ng vá»›i nÃ³.</p>
<p>Hiá»‡n táº¡i Integration trong AWS há»— trá»£ káº¿t ná»‘i theo cÃ¡c dáº¡ng sau:</p>
<ul>
<li>AWS lambda service: Gá»i tháº³ng xuá»‘ng lambda cá»§a AWS ( cÅ©ng lÃ  1 dá»‹ch vá»¥ serverless cá»§a AWS)</li>
<li>HTTP API: Gá»i Ä‘áº¿n 1 public HTTP API, Ä‘Ã¢y lÃ  kiá»ƒu proxy integration. VÃ­ dá»¥ mÃ¬nh cÃ³ 1 service riÃªng á»Ÿ Â <code>https://petstore-khang.com/pets</code> . Sau khi mÃ¬nh attach HTTP integration nÃ y vÃ o vá»›i route vÃ  method GET /pets thÃ¬ khi gá»i client gá»i Ä‘áº¿n GET /pets, cÃ¡c thÃ´ng tin vá» request sáº½ Ä‘Æ°á»£c call xuá»‘ng vá»  service cá»§a mÃ¬nh lÃ  <code>https://petstore-khang.com/pets</code>. NgoÃ i ra mÃ¬nh cÃ³ thá»ƒ cÃ i Ä‘áº·t vá» timeout - thá»i gian pháº£n há»“i tá»‘i Ä‘a cá»§a 1 request Ä‘áº¿n Integration nÃ y, náº¿u vÆ°á»£t quÃ¡ sáº½ raise lá»—i.</li>
</ul>
<img src="images/integration.png" alt="API integration" style="width:100%">
<p>á» API Integration cÃ³ má»™t nhiá»‡m vá»¥ ná»¯a Ä‘Ã³ lÃ  transform cÃ¡c request, response Ä‘áº¿n upstream service. Gá»i táº¯t lÃ  Parameter Mapping.</p>
<ul>
<li>
<p>Transform API requests: á» Ä‘Ã¢y mÃ¬nh cÃ³ thá»ƒ thay Ä‘á»•i thÃ´ng tin cá»§a request trÆ°á»›c khi gá»­i Ä‘áº¿n upstream service nhÆ° thay Ä‘á»•i, thÃªm, sá»­a, xoÃ¡ cÃ¡c header, querystring, vÃ  path, â€¦ Vá»›i vÃ­ dá»¥ dÆ°á»›i lÃ  thÃªm giÃ¡ trá»‹ cá»§a querystring vÃ  header vá»›i cáº·p key-value lÃ  {name: Khang} vÃ  {fromService: Amazon}. Vá»›i setup nÃ y thÃ¬ á»Ÿ dÆ°á»›i service sáº½ nháº­n Ä‘Æ°á»£c giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng. NgoÃ i viá»‡c sá»­ dá»¥ng cÃ¡c static value thÃ¬ AWS cÃ²n support cÃ¡c value á»Ÿ dáº¡ng tÄ©nh Ä‘á»ƒ cÃ³ thá»ƒ báº¯t Ä‘Æ°á»£c cÃ¡c context khi gá»i nhÆ° Ä‘á»‹a chá»‰ IP, Region, â€¦
<img src="images/requestmapping.png" alt="Request Mapping" style="width:100%"></p>
</li>
<li>
<p>Transform API response: á» Ä‘Ã¢y sau khi nháº­n response tá»« upstream service, mÃ¬nh cÃ³ thá»ƒ thay Ä‘á»•i cÃ¡c thÃ´ng tin cá»§a response vÃ­ dá»¥ nhÆ° headers, status code, body, â€¦ CÅ©ng nhÆ° á»Ÿ trÃªn, á»Ÿ Ä‘Ã¢y mÃ¬nh thay Ä‘á»•i status code tá»« 200 vá» 202 vÃ  thÃªm 1 header tráº£ vá» lÃ  change = True
<img src="images/responsemapping.png" alt="Response Mapping" style="width:100%"></p>
</li>
</ul>
<h2 id="deploy-api-stage-and-api-deployment">Deploy: API Stage and API Deployment</h2>
<p>Vá»›i API Stage lÃ  Ä‘áº¿n giai Ä‘oáº¡n setup xong cáº¥u hÃ¬nh cá»§a API, chuyá»ƒn sang giai Ä‘oáº¡n publish API ra ngoÃ i. API Stage lÃ  má»™t Ä‘á»‹nh danh logic chá»‰ stage cá»§a API Ä‘Ã³ trong Gateway. VÃ­ dá»¥ nhÆ° dev, prod, v1, v2. VÃ  nÃ³ sáº½ Ä‘Æ°á»£c gáº¯n vÃ o URL expose ra bÃªn ngoÃ i gá»i lÃ  Invoke URL. Trong má»—i stage thÃ¬ cÃ³ cÃ¡c configure Ä‘á»ƒ cÃ³ thá»ƒ tá»± Ä‘á»™ng deploy má»—i khi cÃ³ thay Ä‘á»•i á»Ÿ cáº¥u hÃ¬nh API.</p>
<p>Vá»›i API Deployment, lÃ  má»™t báº£n snapshot cá»§a cáº¥u hÃ¬nh API vÃ  Ä‘Æ°á»£c gáº¯n vá»›i API vÃ  Stage.</p>
<img src="images/stage.png" alt="API stage" style="width:100%">
<h2 id="deploy-custom-domain-name">Deploy: Custom Domain Name</h2>
<p>Sau khi deploy thÃ nh cÃ´ng API tÆ°Æ¡ng á»©ng vá»›i stage, VÃ­ dá»¥ nhÆ° trÃªn vá»›i Invoke URL khÃ¡ xáº¥u vÃ  Ä‘á»ƒ lá»™ ra thÃ´ng tin cáº¥u hÃ¬nh. Trong thá»±c táº¿, chÃºng ta sáº½ sá»­ dá»¥ng Domain Name Ä‘á»ƒ thay tháº¿ cho URL nÃ y.</p>
<p>Sau khi tiáº¿n hÃ nh register domain há»£p lá»‡ vÃ  chÃºng ta thiáº¿t láº­p láº¡i cÆ¡ cháº¿ Mapping nhÆ° sau. Sau Ä‘Ã³ thay vÃ¬ gá»i vÃ o Invoke URL, chÃºng ta sáº½ gá»i API thÃ´ng qua Domain Name URL cá»§a mÃ¬nh.</p>
<table>
<thead>
<tr>
<th><a href="https://khang.api.example.com/prod">https://khang.api.example.com/prod</a></th>
<th><a href="https://92d27nzpl6.execute-api.ap-southeast-1.amazonaws.com/prod">https://92d27nzpl6.execute-api.ap-southeast-1.amazonaws.com/prod</a></th>
</tr>
</thead>
</table>
<h2 id="monitor-logging">Monitor: Logging</h2>
<p>Khi Ä‘Ã£ hoÃ n thÃ nh viá»‡c setup vá» cáº£ develop vÃ  deploy. ThÃ¬ káº¿ tiáº¿p lÃ  giai Ä‘oáº¡n setup vá» Logging Ä‘á»ƒ tiáº¿n hÃ nh Monitor.  á» Ä‘Ã¢y AWS há»— trá»£ viá»‡c setup lÆ°u láº¡i cÃ¡c Access Log - lÃ  cÃ¡c Log liÃªn quan Ä‘áº¿n request vÃ  response. ThÃ´ng thÆ°á»ng á»Ÿ Ä‘Ã¢y mÃ¬nh sáº½ chá»n luÃ´n Log Destination lÃ  má»™t Log Group trong AWS CloudWatch.  Ná»™i dung cá»§a tá»«ng record log sáº½ Ä‘Æ°á»£c máº·c Ä‘á»‹nh vÃ  thÃªm bá»›t theo format nhÆ° dÆ°á»›i. VÃ­ dá»¥ nhÆ° mÃ¬nh muá»‘n log vá» IP thÃ¬ dÃ¹ng $context.identity.sourceIP.  Tuá»³ vÃ o trÆ°á»ng há»£p mÃ¬nh cáº§n lÆ°u log record nhÆ° tháº¿ nÃ o Ä‘á»ƒ dá»… dÃ ng tracking vÃ  lÃ m cÃ¡c tÃ¡c vá»¥ thá»‘ng kÃª sau nÃ y.</p>
<img src="images/logging.png" alt="API logging" style="width:100%">
<h2 id="protect-rate-limit-and-burst-limit">Protect: Rate limit and Burst limit</h2>
<p>NhÆ° Ä‘Ã£ Ä‘á» cáº­p á»Ÿ <a href="https://khangt1k25.github.io/tech/api_gateway/:">bÃ i trÆ°á»›c vá» API Gateway nÃ³i chung</a>. CÃ¡c tÃ­nh nÄƒng vá» Limit lÃ  thá»© khÃ´ng thá»ƒ thiáº¿u á»Ÿ API Gateway. á» AWS, há» Ä‘Ã£ Ä‘Æ°a pháº§n Limit nÃ y vÃ o Protect Views - dÆ°á»›i dáº¡ng API limit. NghÄ©a ráº±ng, vá»›i má»—i API mÃ¬nh sáº½ Ä‘Æ°á»£c setup cÃ¡c cáº¥u hÃ¬nh limit riÃªng. Core náº±m bÃªn dÆ°á»›i cá»§a há» váº«n lÃ  thuáº­t toÃ¡n vá» Bucket Ä‘á»ƒ Ä‘áº¿m token counter cho má»™t Ä‘á»‹nh danh truy váº¥n.  Vá»›i má»™t cáº¥u hÃ¬nh thÃ¬ cÃ³ thá»ƒ setup 2 thÃ´ng sá»‘</p>
<ul>
<li>Rate Limit : sá»‘ request nháº­n tá»‘i Ä‘a trong má»™t giÃ¢y Ä‘á»“ng há»“</li>
<li>Burst Limit: Sá»‘ request tá»‘i Ä‘a Ä‘Æ°á»£c xá»­ lÃ½ táº¡i má»™t thá»i Ä‘iá»ƒm</li>
</ul>
<p>NgoÃ i ra cÃ²n support Limit dá»±a trÃªn Account</p>
<img src="images/ratelimit.png" alt="API rate burst limit" style="width:100%">
<h2 id="optimize-caching">Optimize: Caching</h2>
<p>Sau khi hoÃ n thÃ nh cÃ¡c view trÆ°á»›c, Ä‘Ã¢y lÃ  view addons vá»›i tÃªn lÃ  Optimize - nháº±m tá»‘i Æ°u viá»‡c sá»­ dá»¥ng vÃ  quáº£n lÃ½ API Gateway. Trong Ä‘Ã³, má»™t cÃ¡ch tá»‘i Æ°u Ä‘Æ¡n giáº£n vÃ  hiá»‡u quáº£ Ä‘Ã³ lÃ  Caching. Vá»›i Caching thÃ¬ sáº½ lÃ m giáº£m Ä‘Æ°á»£c sá»‘ láº§n mÃ  API Gateway gá»i xuá»‘ng cÃ¡c service do cÃ¡c káº¿t quáº£ Ä‘Ã£ Ä‘Æ°á»£c cache láº¡i (gá»i lÃ  cached response) vÃ  tráº£ vá» ngay.  Thá»i gian lÆ°u trá»¯ cá»§a cached response dá»±a theo thÃ´ng sá»‘ TTL ( time-to-live) xÃ¡c Ä‘á»‹nh khoáº£ng thá»i gian tá»“n táº¡i cá»§a 1 cached response object trong há»‡ thá»‘ng.</p>
<h2 id="distribute-usage-plan-and-api-key">Distribute: Usage Plan and API Key</h2>
<p>Usage plan lÃ  má»™t gÃ³i sá»­ dá»¥ng API, khi Ä‘Æ°á»£c gáº¯n vá»›i API vÃ  Client, nÃ³ sáº½ xÃ¡c Ä‘á»‹nh ra bá»™ limit tÆ°Æ¡ng á»©ng dÃ nh cho ngÆ°á»i Ä‘Ã³ khi gá»i API.  Ta cÃ³ thá»ƒ setup cÃ¡c thÃ´ng sá»‘ vá» Rate, Burst cho gÃ³i, ngoÃ i ra cÃ²n cÃ³ thÃ´ng sá»‘ vá» Quota, xÃ¡c Ä‘á»‹nh hard limit dÃ nh theo ngÃ y/thÃ¡ng/tuáº§n. VÃ­ dá»¥: GÃ³i free á»Ÿ dÆ°á»›i Ä‘Æ°á»£c cáº¥u hÃ¬nh rate = 100, burst = 100 vÃ  quota cho 1 thÃ¡ng sá»­ dá»¥ng lÃ  10K requests.</p>
<img src="images/usageplan.png" alt="API usage plan" style="width:100%">
<p>API key lÃ  má»™t Ä‘oáº¡n string Ä‘Æ°á»£c generate ra vÃ  sáº½ Ä‘Æ°a cho client sá»­ dá»¥ng. Má»™t API Key sáº½ cÃ³ name ( tÃªn cá»§a key) vÃ  value ( giÃ¡ trá»‹ lÃ  Ä‘oáº¡n string - cáº§n Ä‘Æ°á»£c giá»¯ bÃ­ máº­t, chá»‰ client nháº¥t Ä‘á»‹nh má»›i cÃ³ Ä‘Æ°á»£c giÃ¡ trá»‹ nÃ y). Client sáº½ sá»­ dá»¥ng API Key nÃ y Ä‘á»ƒ gá»i Ä‘áº¿n API Gateway. Vá» máº·t API Gateway, nÃ³ sáº½ khÃ´ng quan tÃ¢m bÃªn ngoÃ i lÃ  Client nÃ o mÃ  sáº½ chá»‰ quan tÃ¢m Ä‘áº¿n Key nÃ o vá»«a gá»i ? Key Ä‘Ã³ cÃ³ quyá»n Access hay khÃ´ng ? Khi design há»‡ thá»‘ng cÃ³ thá»ƒ coi 1 API key lÃ  1 user hoáº·c 1 group.</p>
<p>Giá» lÃ  bÆ°á»›c <strong>Associated</strong> giá»¯a API, Usage plan vÃ  API Key. Pháº£i tráº£ lá»i hai cÃ¢u há»i sau Ä‘Ã¢y.</p>
<p>GÃ³i free nÃ y sáº½ sá»­ dá»¥ng trÃªn API nÃ o? AWS sáº½ cho phÃ©p ta cáº¥u hÃ¬nh <strong>Associated stages.</strong>  Ta sáº½ gáº¯n gÃ³i free vá»›i má»™t API Stage vá»›i cÃ¢u tráº£ lá»i ráº±ng: GÃ³i free nÃ y sá»­ dá»¥ng trÃªn API nÃ y.</p>
<p>Ai sáº½ sá»­ dá»¥ng gÃ³i free nÃ y?  Ta sáº½ <strong>Associate API Key</strong> cá»§a client 1 vÃ o Ä‘á»ƒ client 1 cÃ³ thá»ƒ sá»­ dá»¥ng gÃ³i free.</p>
<p>Sau khi xong bÆ°á»›c nÃ y, client 1 cÃ³ thá»ƒ gá»i Ä‘áº¿n API vá»›i gÃ³i lÃ  free - cÃ³ cÃ¡c thÃ´ng sá»‘ nhÆ° cáº¥u hÃ¬nh á»Ÿ gÃ³i.</p>
<img src="images/associated_apikeys.png" alt="Request Mapping" style="width:100%">
<h2 id="advantages">Advantages</h2>
<p>Sau quÃ¡ trÃ¬nh sá»­ dá»¥ng AWS API Gateway Ä‘á»ƒ build lÃªn há»‡ thá»‘ng API marketplace trong dá»± Ã¡n cá»§a cÃ´ng ty. MÃ¬nh nháº­n tháº¥y Ä‘Ã¢y lÃ  má»™t service siÃªu tiá»‡n dá»¥ng Ä‘áº¿n tá»« nhÃ  AWS vÃ  hÆ°á»›ng Ä‘áº¿n viá»‡c tá»‘i giáº£n hoÃ¡ cÃ¡c bÆ°á»›c khi táº¡o API Gateway. Má»™t sá»‘ Æ°u Ä‘iá»ƒm theo mÃ¬nh cáº£m nháº­n:</p>
<ul>
<li>Tiá»‡n lá»£i, dá»… dÃ¹ng, khÃ´ng cáº§n pháº£i code custom quÃ¡ nhiá»u, phÃ¹ há»£p cho cÃ¡c API gateway khÃ´ng cáº§n custom quÃ¡ nhiá»u</li>
<li>KhÃ´ng cáº§n pháº£i HA, chá»‹u táº£i vÃ  scale  - Ä‘Ã£ cÃ³ AWS lo</li>
<li>CÃ³ cÃ¡c documen ráº¥t clear vÃ  cÃ³ use-case cá»¥ thá»ƒ Ä‘á»ƒ mÃ¬nh tham kháº£o vÃ  quan trá»ng lÃ  cÃ³ API, SDK chÃ¬a ra Ä‘á»ƒ setup</li>
<li>Dá»… dÃ ng káº¿t ná»‘i Ä‘áº¿n cÃ¡c  Internal Service cá»§a nhÃ  AWS.</li>
</ul>
<h2 id="disadvantages">Disadvantages</h2>
<p>NgoÃ i nhá»¯ng Æ°u Ä‘iá»ƒm vá» dá»… dÃ ng sá»­ dá»¥ng thÃ¬ sau Ä‘Ã¢y lÃ  cáº£m nháº­n cá»§a mÃ¬nh khÃ´ng thÃ­ch khi sá»­ dá»¥ng AWS API Gateway, Ä‘Ã³ cÅ©ng lÃ  nhá»¯ng tham kháº£o Ä‘á»ƒ cÃ¡c báº¡n cÃ³ thá»ƒ lá»±a chá»n stack phÃ¹ há»£p nhÃ©.</p>
<ul>
<li>TÃ­nh customize tháº¥p, lÃ  sá»± trade off giá»¯a sá»± Ä‘Æ¡n giáº£n vÃ  tÃ­nh máº¡nh máº½. Äá»‘i vá»›i mÃ¬nh thÃ¬ khi sá»­ dá»¥ng, mÃ¬nh Æ°u tiÃªn tÃ­nh customize nÃ y hÆ¡n do sá»± phá»©c táº¡p cá»§a má»™t sÃ n API team xÃ¢y dá»±ng. VÃ­ dá»¥ chá»‰ cÃ³ 1 Authorizer lÃ  khÃ´ng Ä‘á»§ vÃ  tá»‘c Ä‘á»™ cháº­m khi xá»­ lÃ½ toÃ n bá»™ cÃ¡c tÃ¡c vá»¥ customize trÆ°á»›c khi gá»i request.</li>
<li>Bá»‹ limit ráº¥t nhiá»u: CÃ¡c Limit vá» sá»‘ API, sá»‘ Endpoint hay vá» Protect Ä‘á»u cÃ³ giá»›i háº¡n trÃªn á»Ÿ má»—i tÃ i khoáº£n, vÃ  pháº£i liÃªn há»‡ Ä‘á»ƒ extend ra. KhÃ´ng chá»‰ váº­y thÃ¬ má»™t sá»‘ cáº¥u hÃ¬nh cÃ²n bá»‹ hard limit ( khÃ´ng thá»ƒ má»Ÿ rá»™ng hÆ¡n ). Äiá»u nÃ y áº£nh hÆ°á»›ng ráº¥t nhiá»u Ä‘áº¿n cáº¥u trÃºc cÃ¡c APIs. Do Ä‘Ã³ trÆ°á»›c khi xÃ¢y dá»±ng nÃªn tÃ¬m hiá»ƒu kÄ© pháº§n limit nÃ y Ä‘á»ƒ design há»£p lÃ½. Chi tiáº¿t xem thÃªm <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/limits.html">táº¡i Ä‘Ã¢y</a></li>
</ul>
<h2 id="the-conclusion">The Conclusion</h2>
<p>ÄÃ³ lÃ  nhá»¯ng tráº£i nghiá»‡m cá»§a mÃ¬nh vÃ  Ä‘Ã¢y cÅ©ng coi nhÆ° má»™t buá»•i review vá» AWS API Gateway. Tuy cÃ³ nhá»¯ng Æ°u Ä‘iá»ƒm vÃ  lÃ  nÆ¡i ráº¥t tá»‘t Ä‘á»ƒ báº¯t Ä‘áº§u, nhÆ°ng mÃ¬nh nghÄ© Ä‘Ã¢y khÃ´ng pháº£i lÃ  lá»±a chá»n tá»‘t cho nhá»¯ng há»‡ thá»‘ng phá»©c táº¡p.  Do Ä‘Ã³, mÃ¬nh cÅ©ng sang tÃ¬m hiá»ƒu tech stack khÃ¡c vá» API Gateway vÃ  cÃ¡i tÃªn tiáº¿p theo Ä‘Ã³ lÃ  Kong Gateway. VÃ  sáº½ láº¡i lÃ  má»™t hÃ nh trÃ¬nh tiáº¿p theo Ä‘á»ƒ build cÃ¹ng vá»›i Kong. MÃ¬nh sáº½ ká»ƒ vá» nÃ³ á»Ÿ pháº§n sau.</p>
<p>Xem láº¡i bÃ i trÆ°á»›c nhÃ©:</p>
<ul>
<li><a href="/tech/api_gateway/">The very first: API Gateway</a></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-rest-api.html">https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-rest-api.html</a></li>
<li><a href="https://viblo.asia/p/tim-hieu-aws-api-gateway-RnB5pMW2KPG">https://viblo.asia/p/tim-hieu-aws-api-gateway-RnB5pMW2KPG</a></li>
<li><a href="https://docs.aws.amazon.com/apigateway/">https://docs.aws.amazon.com/apigateway/</a></li>
<li><a href="https://www.youtube.com/watch?v=sDxsTPbUiik">https://www.youtube.com/watch?v=sDxsTPbUiik</a></li>
</ul>

        </div>
    </div>
    
    
        <div class="mt-20">
            <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "khangruni" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    

    
    

</div>


        </div><div class="container">
    <div class="row justify-content-between">
        <div class="col-sm-4">
            <p class="footer">Khangruni Â© 2024 </p>
        </div>
        <div class="col-sm-6 d-flex flex-row-reverse">
            
            <a class="footer-social px-2"  href="https://www.facebook.com/trankhang.nguyen.35/" target="_blank"><i class="fab fa-facebook"></i></a>
            
            <a class="footer-social px-2"  href="https://github.com/khangt1k25" target="_blank"><i class="fab fa-github"></i></a>
            
            <a class="footer-social px-2"  href="https://www.linkedin.com/in/khang-nguyen-tran/" target="_blank"><i class="fab fa-linkedin-in"></i></a>
            
        </div>
    </div>
</div>
<script src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/jquery.min.js"></script>
<script src="/js/isotope.pkgd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D" crossorigin="anonymous" async></script>
<script src="/js/dark.js"></script>
<script>


var savedTheme = localStorage.getItem("dark-mode-storage") || "light" 
setTheme(savedTheme);

</script>
<script src="/js/isotope.js"></script>
<script src="/js/mermaid.min.js"></script>

<script>mermaid.initialize({ startOnLoad: true, securityLevel: 'loose'});</script>
</body>
</html>
